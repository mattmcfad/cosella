/******************************************
 * @author Matt McFadyen @mattmcfad       *
 *                                        *
 *          Nothing to see here!          *
 *                                        *
 *    Check out the github repo here:     *
 * https://github.com/mmcfadyen91/cosella *
 ******************************************/
function formatTime(a){return a/1e3}var case0={test:function(a,b){return a.solved===!0||b.solved===!0?!1:a.id===b.id?!0:!1}},case1={test:function(a,b){var c,d=a.x,e=a.y,f=!1;if(a.x===b.x){if(a.y<b.y)for(;e<b.y;){if(e++,c=$("#"+app.getId(d,e)),e===b.y){f=!0;break}if(c.data().solved===!1){f=!1;break}}if(a.y>b.y)for(;e>b.y;){if(e--,c=$("#"+app.getId(d,e)),e===b.y){f=!0;break}if(c.data().solved===!1){f=!1;break}}}else if(a.y===b.y)if(a.x<b.x)for(;d<b.x;){if(d++,c=$("#"+app.getId(d,e)),d===b.x){f=!0;break}if(c.data().solved===!1){f=!1;break}}else if(a.x>b.x)for(;d>b.x;){if(d--,c=$("#"+app.getId(d,e)),d===b.x){f=!0;break}if(c.data().solved===!1){f=!1;break}}return f===!0?(app.matchSuccess(a,b),!0):!1}},case2={test:function(a,b){function c(){g=a.x,h=a.y,i=!1}var d,e,f,g=a.x,h=a.y,i=!1;if(a.x<b.x){if(!i)for(c();h>1&&i!==!0&&(h--,f=$("#"+app.getId(g,h)),f.data().solved===!0||void 0===f.data().solved);){for(;g<b.x;){if(g++,f=$("#"+app.getId(g,h)),h===b.y&&g===b.x){i=!0;break}if(f.data().solved!==!0&&void 0!==f.data().solved)break;if(g===b.x){for(e=h;h<b.y;){if(h++,f=$("#"+app.getId(g,h)),h===b.y){i=!0;break}if(f.data().solved===!1)break}h=e}}g=a.x}if(!i)for(c();12>h&&i!==!0&&(h++,f=$("#"+app.getId(g,h)),f.data().solved===!0||void 0===f.data().solved);){for(;g<b.x;){if(g++,f=$("#"+app.getId(g,h)),h===b.y&&g===b.x){i=!0;break}if(f.data().solved!==!0&&void 0!==f.data().solved)break;if(g===b.x){for(e=h;h>b.y;){if(h--,f=$("#"+app.getId(g,h)),h===b.y){i=!0;break}if(f.data().solved===!1)break}h=e}}g=a.x}}if(a.y>b.y){if(!i)for(c();12>g&&i!==!0&&(g++,f=$("#"+app.getId(g,h)),f.data().solved===!0||void 0===f.data().solved);){for(;h>b.y;){if(h--,f=$("#"+app.getId(g,h)),h===b.y&&g===b.x){i=!0;break}if(f.data().solved!==!0&&void 0!==f.data().solved)break;if(h===b.y){for(d=g;g>b.x;){if(g--,f=$("#"+app.getId(g,h)),g===b.x){i=!0;break}if(f.data().solved===!1)break}g=d}}h=a.y}if(!i)for(c();g>1&&i!==!0&&(g--,f=$("#"+app.getId(g,h)),f.data().solved===!0||void 0===f.data().solved);){for(;h>b.y;){if(h--,f=$("#"+app.getId(g,h)),h===b.y&&g===b.x){i=!0;break}if(f.data().solved!==!0&&void 0!==f.data().solved)break;if(h===b.y){for(d=g;g<b.x;){if(g++,f=$("#"+app.getId(g,h)),g===b.x){i=!0;break}if(f.data().solved===!1)break}g=d}}h=a.y}}if(a.x>b.x){if(!i)for(c();h>1&&i!==!0&&(h--,f=$("#"+app.getId(g,h)),f.data().solved===!0||void 0===f.data().solved);){for(;g>b.x;){if(g--,f=$("#"+app.getId(g,h)),h===b.y&&g===b.x){i=!0;break}if(f.data().solved!==!0&&void 0!==f.data().solved)break;if(g===b.x){for(e=h;h<b.y;){if(h++,f=$("#"+app.getId(g,h)),h===b.y){i=!0;break}if(f.data().solved===!1)break}h=e}}g=a.x}if(!i)for(c();12>h&&i!==!0&&(h++,f=$("#"+app.getId(g,h)),f.data().solved===!0||void 0===f.data().solved);){for(;g>b.x;){if(g--,f=$("#"+app.getId(g,h)),h===b.y&&g===b.x){i=!0;break}if(f.data().solved!==!0&&void 0!==f.data().solved)break;if(g===b.x){for(e=h;h>b.y;){if(h--,f=$("#"+app.getId(g,h)),h===b.y){i=!0;break}if(f.data().solved===!1)break}h=e}}g=a.x}}if(a.y<b.y){if(!i)for(c();12>g&&i!==!0&&(g++,f=$("#"+app.getId(g,h)),f.data().solved===!0||void 0===f.data().solved);){for(;h<b.y;){if(h++,f=$("#"+app.getId(g,h)),h===b.y&&g===b.x){i=!0;break}if(f.data().solved!==!0&&void 0!==f.data().solved)break;if(h===b.y){for(d=g;g>b.x;){if(g--,f=$("#"+app.getId(g,h)),g===b.x){i=!0;break}if(f.data().solved===!1)break}g=d}}h=a.y}if(!i)for(c();g>1&&i!==!0&&(g--,f=$("#"+app.getId(g,h)),f.data().solved===!0||void 0===f.data().solved);){for(;h<b.y;){if(h++,f=$("#"+app.getId(g,h)),h===b.y&&g===b.x){i=!0;break}if(f.data().solved!==!0&&void 0!==f.data().solved)break;if(h===b.y){for(d=g;g<b.x;){if(g++,f=$("#"+app.getId(g,h)),g===b.x){i=!0;break}if(f.data().solved===!1)break}g=d}}h=a.y}}return i?(app.matchSuccess(a,b),!0):!1}},case3={test:function(a,b){function c(){g=a.x,h=a.y,i=!1}var d,e,f,g=a.x,h=a.y,i=!1;if(a.x<b.x){if(!i)for(c();g<b.x&&!i&&(g++,f=$("#"+app.getId(g,h)),f.data().solved===!0||void 0===f.data().solved);){for(;h>b.y;){if(h--,f=$("#"+app.getId(g,h)),h===b.y&&g===b.x){i=!0;break}if(f.data().solved!==!0&&void 0!==f.data().solved)break;if(h===b.y){for(d=g;g<b.x;){if(g++,f=$("#"+app.getId(g,h)),g===b.x&&h===b.y){i=!0;break}if(f.data().solved===!1)break}g=d}}h=a.y}if(!i)for(c();g<b.x&&!i&&(g++,f=$("#"+app.getId(g,h)),f.data().solved===!0||void 0===f.data().solved);){for(;h<b.y;){if(h++,f=$("#"+app.getId(g,h)),h===b.y&&g===b.x){i=!0;break}if(f.data().solved!==!0&&void 0!==f.data().solved)break;if(h===b.y){for(d=g;g<b.x;){if(g++,f=$("#"+app.getId(g,h)),g===b.x&&h===b.y){i=!0;break}if(f.data().solved===!1)break}g=d}}h=a.y}}if(a.y>b.y){if(!i)for(c();h>b.y&&!i&&(h--,f=$("#"+app.getId(g,h)),f.data().solved===!0||void 0===f.data().solved);){for(;g<b.x;){if(g++,f=$("#"+app.getId(g,h)),h===b.y&&g===b.x){i=!0;break}if(f.data().solved!==!0&&void 0!==f.data().solved)break;if(g===b.x){for(e=h;h>b.y;){if(h--,f=$("#"+app.getId(g,h)),g===b.x&&h===b.y){i=!0;break}if(f.data().solved===!1)break}h=e}}g=a.x}if(!i)for(c();h>b.y&&!i&&(h--,f=$("#"+app.getId(g,h)),f.data().solved===!0||void 0===f.data().solved);){for(;g>b.x;){if(g--,f=$("#"+app.getId(g,h)),h===b.y&&g===b.x){i=!0;break}if(f.data().solved!==!0&&void 0!==f.data().solved)break;if(g===b.x){for(e=h;h>b.y;){if(h--,f=$("#"+app.getId(g,h)),g===b.x&&h===b.y){i=!0;break}if(f.data().solved===!1)break}h=e}}g=a.x}}if(a.x>b.x){if(!i)for(c();g>b.x&&!i&&(g--,f=$("#"+app.getId(g,h)),f.data().solved===!0||void 0===f.data().solved);){for(;h>b.y;){if(h--,f=$("#"+app.getId(g,h)),h===b.y&&g===b.x){i=!0;break}if(f.data().solved!==!0&&void 0!==f.data().solved)break;if(h===b.y){for(d=g;g>b.x;){if(g--,f=$("#"+app.getId(g,h)),g===b.x&&h===b.y){i=!0;break}if(f.data().solved===!1)break}g=d}}h=a.y}if(!i)for(c();g>b.x&&!i&&(g--,f=$("#"+app.getId(g,h)),f.data().solved===!0||void 0===f.data().solved);){for(;h<b.y;){if(h++,f=$("#"+app.getId(g,h)),h===b.y&&g===b.x){i=!0;break}if(f.data().solved!==!0&&void 0!==f.data().solved)break;if(h===b.y){for(d=g;g>b.x;){if(g--,f=$("#"+app.getId(g,h)),g===b.x&&h===b.y){i=!0;break}if(f.data().solved===!1)break}g=d}}h=a.y}}if(a.y<b.y){if(!i)for(c();h<b.y&&!i&&(h++,f=$("#"+app.getId(g,h)),f.data().solved===!0||void 0===f.data().solved);){for(;g<b.x;){if(g++,f=$("#"+app.getId(g,h)),h===b.y&&g===b.x){i=!0;break}if(f.data().solved!==!0&&void 0!==f.data().solved)break;if(g===b.x){for(e=h;h<b.y;){if(h++,f=$("#"+app.getId(g,h)),g===b.x&&h===b.y){i=!0;break}if(f.data().solved===!1)break}h=e}}g=a.x}if(!i)for(c();h<b.y&&!i&&(h++,f=$("#"+app.getId(g,h)),f.data().solved===!0||void 0===f.data().solved);){for(;g>b.x;){if(g--,f=$("#"+app.getId(g,h)),h===b.y&&g===b.x){i=!0;break}if(f.data().solved!==!0&&void 0!==f.data().solved)break;if(g===b.x){for(e=h;h<b.y;){if(h++,f=$("#"+app.getId(g,h)),g===b.x&&h===b.y){i=!0;break}if(f.data().solved===!1)break}h=e}}g=a.x}}return i?(app.matchSuccess(a,b),!0):!1}},firebase={init:function(){firebase.db=new Firebase("https://cosella.firebaseio.com/highscores"),firebase.localDB=Array(),firebase.db.on("child_added",function(a){var b=a.val();firebase.localDB.push(b)})},push:function(a,b,c,d){firebase.db.push({name:a,twitter:b,level:c,score:d})},parseScore:function(a,b){$("#usrlvl").text(b),$("#usrpoints").text(a);var c={name:"You!",twitter:"@yourTwitterHandle",level:b,score:a};firebase.localDB.push(c),$("#usrRank").text(firebase.getRank())},getRank:function(){firebase.sortDB();for(var a=0;a<firebase.localDB.length;a++)if("You!"===firebase.localDB[a].name)return a+1;return"99"},sortDB:function(){firebase.localDB.sort(function(a,b){return b.score-a.score})},getHighscores:function(){var a=$("ol");a.html("");for(var b=0;b<firebase.localDB.length;b++){var c=firebase.localDB[b].twitter;"@"!==c.charAt(0)&&(c="@"+c);var d="https://twitter.com/"+c;a.append("<li class='scoreListItem'><div class='middle'><div class='top'>"+firebase.localDB[b].name+"<span class='usrlvl'> Level</span></div><div class='bottom'><a href='"+d+"'target='_blank'>"+c+"</a><span class='usrlvl'>"+firebase.localDB[b].level+"</span></div></div> <p class='right'>"+firebase.localDB[b].score+"</p></li>")}}},icons=[{id:0,color:"darkblue",img:"Qbert"},{id:1,color:"saddlebrown",img:"Hami"},{id:2,color:"gold",img:"Chris"},{id:3,color:"gray",img:"Rob"},{id:4,color:"mediumaquamarine",img:"Simon"},{id:5,color:"darkkhaki",img:"Owen"},{id:6,color:"brown",img:"Mark-L"},{id:7,color:"peru",img:"Steven"},{id:8,color:"deeppink",img:"Brian"},{id:9,color:"cyan",img:"Raymond"},{id:10,color:"lightcoral",img:"Hannah"},{id:11,color:"steelblue",img:"Adam"},{id:12,color:"darkviolet",img:"Jenn"},{id:13,color:"limegreen",img:"Rebecca"},{id:14,color:"whitesmoke",img:"Hema"}],app={init:function(){app.timeLimit=1e5,app.count=app.timeLimit,$("#countdown").html(formatTime(app.count)),timer.set({time:10,autostart:!1}),app.score=0,$(".totscore").html(app.score),app.gamePaused=!1,app.totCells=144,app.currentLevel=1;var a=$("#gamegrid");app.moreTime=3,$("#addMoreTime").text(app.moreTime),app.reOrders=2,$("#addReOrder").text(app.reOrders);for(var b='<div class=cell data-id="null" style="background-color: rgba(237,236,236,1)" id=',c='<div class=cell data-id="null" style="background-color: transparent" id=',d="></div>",e="",f=1;f<app.totCells+1;f++)e=1===app.getX(f)||12===app.getX(f)||1===app.getY(f)||12===app.getY(f)?c+f+d:b+f+d,a.append(e),e=b;app.octocatTracker=Array(),app.buildIcons(app.currentLevel)},eventListeners:function(){function a(){app.gamePaused===!0&&timer.play(),$(".overlay").fadeOut()}var b=!1;$(".cell").on("click",function(a){a.preventDefault();var c=$(this),d=c.data();null!==d.id&&(timer.isActive||timer.play(!0),b===!1?(b=!0,c.addClass("selected"),app.first=d):app.getId(d.x,d.y)===app.getId(app.first.x,app.first.y)?(c.removeClass("selected"),b=!1):(b=!1,app.second=d,app.checkMatch()))}),$(".overlay").on("click",function(){$(this).hasClass("close")&&a()}),$("#nextLvl").on("click",function(){$("#nextLevel").fadeOut(),app.buildIcons(app.currentLevel)}),$(".playAgain").on("click",function(){app.restartGame()}),$("#highScores").on("click",function(){app.highScores()}),$("#submitScore").on("click",function(){var a=$("#inputTwitter").val(),b=$("#inputName").val();""===b?app.displayMessage("error"):(""===a&&(a="@mattmcfad"),app.submitScore(b,a))}),$("#moreTime").on("click",function(){0!==app.moreTime&&app.addMoreTime()}),$("#reOrder").on("click",function(){0!==app.reOrders&&(app.reOrder(app.rows,app.columns,app.start),app.reOrders--,0===app.reOrders&&$("#reOrder").addClass("depletedButton"),$("#addReOrder").text(app.reOrders))}),$("#instruct").on("click",function(){app.instructions()})},removeEventHandlers:function(){$("button").off()},buildIcons:function(a){function b(a){c=new Array(icons.length);for(var b=0;b<icons.length;b++)c[b]=0;switch(a>4&&(a=4),a){case 1:j=40,f=6,g=6;break;case 2:j=27,f=8,g=8;break;case 3:j=26,f=8,g=10;break;case 4:j=14,f=10,g=10}e=f*g,app.totIcons=e,d=0,k="#",app.start=j,app.rows=f,app.columns=g}app.totSolved=0;var c,d,e,f,g,h,i,j,k,l;b(a);for(var m=0;g>m;m++)for(var n=0;f>n;n++){l=j+m+12*n;var o=$(k+l);if(e-d<=icons.length){i=!1;for(var p=0;p<c.length;p++)if(c[p]%2===1){h=icons[p],i=!0;break}i===!1&&(h=app.getIcon())}else h=app.getIcon();c[h.id]++,d++;var q="url(images/icons/"+h.img+".png)";o.css("background-image",q),o.data("id",h.img),o.data("solved",!1),o.data("x",app.getX(l)),o.data("y",app.getY(l))}app.reOrder(f,g,j)},getIcon:function(){var a=Math.floor(Math.random()*icons.length);return icons[a]},getOctocat:function(){return app.currentLevel>=octocats.length?octocats[octocats.length-1]:octocats[app.currentLevel-2]},getX:function(a){return a%12===0?12:a%12},getY:function(a){return Math.ceil(a/12)},getId:function(a,b){return a+12*(b-1)},increaseScore:function(){app.score+=10,$(".totscore").html(app.score)},checkMatch:function(){$(".cell").removeClass("selected"),case0.test(app.first,app.second)===!0&&case1.test(app.first,app.second)===!1&&case2.test(app.first,app.second)===!1&&case3.test(app.first,app.second)},matchSuccess:function(a,b){cell1=$("#"+app.getId(a.x,a.y)),cell2=$("#"+app.getId(b.x,b.y)),"Qbert"===cell1.data("id")&&(app.moreTime++,0!==app.moreTime&&$("#moreTime").removeClass("depletedButton"),$("#addMoreTime").text(app.moreTime)),cell1.data("solved",!0),cell1.data("id",null),cell2.data("solved",!0),cell2.data("id",null),cell1.css("background-color","rgba(237,236,236,1)"),cell2.css("background-color","rgba(237,236,236,1)"),cell1.css("background-image","none"),cell2.css("background-image","none"),app.totSolved=app.totSolved+2,app.increaseScore(),app.testLevelCompletion()},testLevelCompletion:function(){if(app.totSolved===app.totIcons){timer.stop(),$("#countdown").removeClass("lowTime");var a=parseInt(formatTime(app.count));app.score+=a,app.currentLevel++;var b=0;app.currentLevel>4&&(b=10*(app.currentLevel-4)*1e3),app.reOrders=2,0!==app.reOrders&&$("#reOrder").removeClass("depletedButton"),$("#addReOrder").text(app.reOrders),app.count=app.timeLimit-b,app.count<=0&&(app.count=1e4),$("#countdown").html(formatTime(app.count)),app.nextLevel()}},nextLevel:function(){$("#nextLevel").fadeIn(),$(".totscore").html(app.score);var a=app.getOctocat(),b="images/octocats/"+a.img,c=a.msg,d=a.button;$("#octocat").attr("src",b),$("#quote").text(c),$("#nextLvl").text(d)},reOrder:function(a,b,c){function d(){var a=Math.floor(Math.random()*g.length);return h.contains(a)?d(length):(h.push(a),a)}for(var e,f=Array(),g=Array(),h=Array(),i="#",j=0;b>j;j++)for(var k=0;a>k;k++){e=c+j+12*k;var l=$(i+e);null!==l.data().id&&(f.push(e),g.push(l.data().id))}for(var m=0;m<f.length;m++){var n=$(i+f[m]),o=d();n.data("id",g[o]);var p="url(images/icons/"+g[o]+".png)";n.css("background-image",p)}},addMoreTime:function(){app.moreTime--,0===app.moreTime&&$("#moreTime").addClass("depletedButton"),$("#addMoreTime").text(app.moreTime),app.count=app.count+1e4},instructions:function(){app.gamePaused=!0,timer.pause(),$("#instructions").fadeIn()},gameOver:function(){$("#timesUp").fadeIn(),$("#gameOverOcto").attr("src","images/octocats/gameover.png")},restartGame:function(){$("#gamegrid").html(""),timer.pause(),app.init(),firebase.init(),app.removeEventHandlers(),app.eventListeners(),$("#countdown").removeClass("lowTime"),$("button").removeClass("depletedButton"),$("#highScore").fadeOut(),$("#timesUp").fadeOut(),$("input").val("")},highScores:function(){$("#highScore").fadeIn(),firebase.parseScore(app.score,app.currentLevel),firebase.getHighscores(),$("#timesUp").hide(),$("#submitScore").show()},submitScore:function(a,b){firebase.push(a,b,app.currentLevel,app.score),$("#submitScore").fadeOut(),app.displayMessage("submit")},displayMessage:function(a){$("#"+a).show(),setTimeout(function(){$("#"+a).fadeOut()},1500)}};$(document).ready(function(){app.init(),firebase.init(),app.eventListeners()}),Array.prototype.contains=function(a){for(var b in this)if(this[b]==a)return!0;return!1};var octocats=[{img:"stormtroopocat.png",msg:"These aren't the droids we're looking for.",button:"Move along.. move along"},{img:"ironcat.jpg",msg:"It's Christmas. Take 'em to Church.",button:"I am Iron Man."},{img:"spidertocat.png",msg:"Who am I?",button:"I'm Spider-Man!"},{img:"octobiwan.jpg",msg:"Use the Force, Luke.",button:"I'm not Luke."},{img:"homercat.png",msg:"Operator! Give me the number for 911!",button:"Doh!"},{img:"okal-eltocat.jpg",msg:"This looks like a job for",button:"Superman!"},{img:"dodgetocat_v2.png",msg:"If you can dodge a wrench, you can dodge a ball.",button:"Put me in, coach!"},{img:"xtocat.jpg",msg:"Don't $^#& this up.",button:"Thank you Logan. I mean that."},{img:"visionary.jpg",msg:"Stay hungry. Stay foolish.",button:"Thanks, Steve."},{img:"murakamicat.png",msg:"Pain is inevitable. Suffering is optional.",button:"?!?!????"},{img:"riddlocat.png",msg:"Riddle me this, Riddle me that.",button:"Who is afraid of the big bad bat?"},{img:"heisencat.png",msg:"We're done when I say we're done.",button:"You're god damn right."},{img:"daftpunktocat-guy.gif",msg:"We are human after all.",button:"Much in common after all."},{img:"daftpunktocat-thomas.gif",msg:"Work it harder, make it better, do it faster",button:"make us stronger."},{img:"nyantocat.gif",msg:"Okay dude, you really play this game too much.",button:"Nyanyanyanyanyanyanya!"}],timer=$.timer(function(){$("#countdown").html(formatTime(app.count)),0===app.count&&(timer.stop(),app.gameOver()),app.count-=10,app.count>1e4?$("#countdown").removeClass("lowTime"):$("#countdown").addClass("lowTime"),app.count<0&&(app.count=0)});